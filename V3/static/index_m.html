<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRA v3 Mobile</title>
    <link rel="stylesheet" href="styles_m.css">
    <script src="/static/marked.min.js"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
    <link rel="manifest" href="/static/images/site.webmanifest">
</head>
<body>
    <div class="container">
        <!-- Compact Header -->
        <header>
            <div class="header-content">
                <h1>MRA v3</h1>
                <div class="subtitle">Research Assistant</div>
            </div>
            <div class="header-status">
                <div class="status-indicator">
                    <div class="status-dot offline" id="ollama-status"></div>
                    <span>Ollama</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot offline" id="twisted-status"></div>
                    <span>TwistedPair</span>
                </div>
            </div>
        </header>

        <!-- Response Area (Top) -->
        <div class="response-section">
            <h2>üí¨ Conversation</h2>
            <div class="chat-messages" id="chat-messages">
                <div class="exchange-container" id="welcome-exchange">
                    <div class="exchange-header">
                        <span class="exchange-summary">üí¨ Welcome Message</span>
                        <span class="exchange-toggle">‚ñº</span>
                    </div>
                    <div class="exchange-content">
                        <div class="message assistant">
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-content">
                                <p>Hello! I'm MRA v3 Mobile. I can help you:</p>
                                <ul>
                                    <li>Search across your papers</li>
                                    <li>Perform web searches</li>
                                    <li>Answer questions with local LLMs</li>
                                    <li>Apply rhetorical distortion</li>
                                </ul>
                                <p>What would you like to explore?</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Query Section -->
        <div class="section query-section">
            <h3>üí¨ Query</h3>
            <textarea 
                id="query-input" 
                class="query-box" 
                placeholder="Ask a question or search your documents..."
                rows="4"
            ></textarea>
            <div class="query-buttons">
                <button class="btn btn-primary" id="send-query-btn">Send</button>
                <button class="btn btn-secondary" id="clear-query-btn">üóëÔ∏è Clear</button>
            </div>
        </div>

        <!-- Search Scope -->
        <div class="section">
            <h3>üìö Search Scope</h3>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="scope-reference">
                    <label for="scope-reference">Reference Papers</label>
                    <span class="count" id="count-reference">823</span>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="scope-authored">
                    <label for="scope-authored">My Papers</label>
                    <span class="count" id="count-authored">7</span>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="scope-sessions">
                    <label for="scope-sessions">Past Sessions</label>
                    <span class="count" id="count-sessions">0</span>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="scope-web-cache">
                    <label for="scope-web-cache">Web Cache</label>
                    <span class="count" id="count-web">0</span>
                </div>
            </div>
        </div>

        <!-- File Upload Section -->
        <div class="section">
            <h3>üì§ Upload Document</h3>
            <input type="file" id="file-upload-input" accept=".pdf,.txt,.csv,.md,.markdown" style="display: none;">
            <button class="btn btn-upload" id="upload-btn">Choose File</button>
            <div id="upload-status" class="upload-status"></div>
        </div>

        <!-- News Articles Browser Section -->
        <div class="section">
            <h3>üì∞ News Articles</h3>
            <button class="btn btn-upload" id="browse-news-btn">Browse Articles</button>
            <div id="news-articles-status" class="upload-status"></div>
        </div>

        <!-- Web Search Toggle -->
        <div class="section">
            <h3>üåê Web Search</h3>
            <div class="toggle-row">
                <label for="enable-web-search">Enable Web Search</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-web-search">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <!-- LLM Settings -->
        <div class="section">
            <h3>‚öôÔ∏è LLM Settings</h3>
            
            <div class="form-group">
                <label for="model-select">Model</label>
                <select id="model-select" disabled>
                    <option value="">Loading models...</option>
                </select>
            </div>
            
            <div class="slider-group">
                <label>
                    Temperature
                    <span id="temp-value">0.7</span>
                </label>
                <input type="range" id="temperature" min="0" max="5" step="0.1" value="0.7">
            </div>
            
            <div class="slider-group">
                <label>
                    Top P
                    <span id="top-p-value">0.9</span>
                </label>
                <input type="range" id="top-p" min="0" max="0.98" step="0.01" value="0.9">
            </div>
            
            <div class="slider-group">
                <label>
                    Top K
                    <span id="top-k-gen-value">40</span>
                </label>
                <input type="range" id="top-k-gen" min="0" max="120" step="1" value="40">
            </div>
            
            <div class="slider-group">
                <label>
                    Max Output Tokens
                    <span id="max-tokens-value">8000</span>
                </label>
                <input type="range" id="max-tokens" min="500" max="64000" step="500" value="8000">
            </div>
            
            <div class="slider-group">
                <label>
                    Context Window
                    <span id="context-window-value">128000</span>
                </label>
                <input type="range" id="context-window" min="8000" max="256000" step="1000" value="128000">
            </div>
            
            <div class="slider-group">
                <label>
                    Max Retrieval Results
                    <span id="top-k-value">20</span>
                </label>
                <input type="range" id="top-k" min="1" max="50" step="1" value="20">
            </div>
        </div>

        <!-- Distortion Panel -->
        <div class="section distortion-panel">
            <div class="distortion-toggle">
                <label style="font-weight: 600;">üé∏ Distortion</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-distortion">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="distortion-controls" id="distortion-controls">
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="ensemble-mode">
                        <span>Ensemble Mode (All 6)</span>
                    </label>
                </div>
                
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="conversation-context" checked>
                        <span>Include Conversation Context</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Mode</label>
                    <select id="distortion-mode">
                        <option value="invert_er">Inverter</option>
                        <option value="so_what_er">So-What-er</option>
                        <option value="echo_er">Echo-er</option>
                        <option value="what_if_er">What-If-er</option>
                        <option value="cucumb_er">Cucumber</option>
                        <option value="archiv_er">Archiver</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Tone</label>
                    <select id="distortion-tone">
                        <option value="neutral">Neutral</option>
                        <option value="technical">Technical</option>
                        <option value="primal">Primal</option>
                        <option value="poetic">Poetic</option>
                        <option value="satirical">Satirical</option>
                    </select>
                </div>
                
                <div class="slider-group">
                    <label>
                        Gain
                        <span id="gain-value">5</span>
                    </label>
                    <input type="range" id="distortion-gain" min="1" max="10" step="1" value="5">
                </div>
            </div>
        </div>

        <!-- Past Sessions Panel -->
        <div class="section sessions-panel">
            <div class="sessions-toggle">
                <label style="font-weight: 600;">üìã Past Sessions</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enable-sessions">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="sessions-list" id="sessions-list">
                <!-- Sessions will be loaded here dynamically -->
            </div>
        </div>
    </div>

    <!-- News Articles Browser Modal -->
    <div id="news-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì∞ News Articles</h2>
                <button class="modal-close" id="news-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="news-search-box">
                    <input type="text" id="news-search-input" placeholder="Filter articles..." />
                </div>
                <div id="news-loading" class="news-loading" style="display: none;">
                    <p>Loading articles...</p>
                </div>
                <div id="news-articles-list" class="news-articles-list">
                    <!-- Articles will be loaded here dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <span id="news-count-display">0 articles</span>
            </div>
        </div>
    </div>

    <script src="app_m.js"></script>
    <script>
        // Emergency diagnostic
        console.log('=== Inline script executing ===');
        console.log('app_m.js loaded:', typeof state !== 'undefined');
        console.log('DOMContentLoaded will fire soon...');
    </script>
</body>
</html>
