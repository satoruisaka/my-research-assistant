<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRA v3 - My Research Assistant</title>
    <link rel="stylesheet" href="styles.css">
    <!-- <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script> -->
    <script src="/static/marked.min.js"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
    <link rel="manifest" href="/static/images/site.webmanifest"> 
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div>
                <h1>My Research Assistant v3</h1>
                <div class="subtitle">Local LLM + Distortion + RAG: Documents + Web Search + Session History</div>
            </div>
            <div class="header-status">
                <div class="status-indicator">
                    <div class="status-dot" id="ollama-status"></div>
                    <span>Ollama</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot offline" id="twisted-status"></div>
                    <span>TwistedPair</span>
                </div>
            </div>
        </header>

        <!-- Left Sidebar: Search Scope & Settings -->
        <aside class="sidebar">
            <!-- Direct Search Input -->
            <div class="sidebar-section">
                <h3>üîç Quick Search</h3>
                <input 
                    type="text" 
                    id="quick-search" 
                    class="search-box" 
                    placeholder="Search documents directly..."
                >
                <button class="search-btn" id="quick-search-btn">Search</button>
            </div>

            <div class="sidebar-section">
                <h3>üìö Search Scope</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="scope-reference">
                        <label for="scope-reference">Reference Papers</label>
                        <span class="count" id="count-reference">823</span>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="scope-authored">
                        <label for="scope-authored">My Papers</label>
                        <span class="count" id="count-authored">7</span>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="scope-sessions">
                        <label for="scope-sessions">Past Sessions</label>
                        <span class="count" id="count-sessions">0</span>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="scope-web-cache">
                        <label for="scope-web-cache">Web Cache</label>
                        <span class="count" id="count-web">0</span>
                    </div>
                </div>
            </div>

            <!-- File Upload Section -->
            <div class="sidebar-section">
                <h3>üì§ Upload Document</h3>
                <input type="file" id="file-upload-input" accept=".pdf,.txt,.csv,.md,.markdown" style="display: none;">
                <button class="upload-btn" id="upload-btn">Choose File</button>
                <div id="upload-status" class="upload-status"></div>
            </div>

            <div class="sidebar-section">
                <h3>üåê Web Search</h3>
                <div class="checkbox-item">
                    <label for="enable-web-search" style="cursor: pointer;">Enable Web Search</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enable-web-search">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>‚öôÔ∏è LLM Settings</h3>
                <div class="select-group">
                    <label for="model-select">Model</label>
                    <select id="model-select" disabled>
                        <option value="">Loading models...</option>
                    </select>
                </div>
                <div class="slider-group">
                    <label>
                        Temperature
                        <span id="temp-value">0.7</span>
                    </label>
                    <input type="range" id="temperature" min="0" max="5" step="0.1" value="0.7">
                </div>
                <div class="slider-group">
                    <label>
                        Top P
                        <span id="top-p-value">0.9</span>
                    </label>
                    <input type="range" id="top-p" min="0" max="0.98" step="0.01" value="0.9">
                </div>
                <div class="slider-group">
                    <label>
                        Top K
                        <span id="top-k-gen-value">40</span>
                    </label>
                    <input type="range" id="top-k-gen" min="0" max="120" step="1" value="40">
                </div>
                <div class="slider-group">
                    <label>
                        Max Output Tokens
                        <span id="max-tokens-value">8000</span>
                    </label>
                    <input type="range" id="max-tokens" min="500" max="64000" step="500" value="8000">
                </div>
                <div class="slider-group">
                    <label>
                        Context Window
                        <span id="context-window-value">128000</span>
                    </label>
                    <input type="range" id="context-window" min="8000" max="256000" step="1000" value="128000">
                </div>
                <div class="slider-group">
                    <label>
                        Max Retrieval Results
                        <span id="top-k-value">20</span>
                    </label>
                    <input type="range" id="top-k" min="1" max="50" step="1" value="20">
                </div>
            </div>

            <!-- Distortion Panel -->
            <div class="distortion-panel">
                <div class="distortion-toggle">
                    <label style="font-weight: 600;">üé∏ Distortion</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enable-distortion">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="distortion-controls" id="distortion-controls">
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="ensemble-mode">
                            <span>Ensemble Mode (All 6)</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="conversation-context" checked>
                            <span>Include Conversation Context</span>
                        </label>
                    </div>
                    <div class="select-group">
                        <label>Mode</label>
                        <select id="distortion-mode">
                            <option value="invert_er">Inverter</option>
                            <option value="so_what_er">So-What-er</option>
                            <option value="echo_er">Echo-er</option>
                            <option value="what_if_er">What-If-er</option>
                            <option value="cucumb_er">Cucumber</option>
                            <option value="archiv_er">Archiver</option>
                        </select>
                    </div>
                    <div class="select-group">
                        <label>Tone</label>
                        <select id="distortion-tone">
                            <option value="neutral">Neutral</option>
                            <option value="technical">Technical</option>
                            <option value="primal">Primal</option>
                            <option value="poetic">Poetic</option>
                            <option value="satirical">Satirical</option>
                        </select>
                    </div>
                    <div class="slider-group">
                        <label>
                            Gain
                            <span id="gain-value">5</span>
                        </label>
                        <input type="range" id="distortion-gain" min="1" max="10" step="1" value="5">
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area">
            <div class="chat-messages" id="chat-messages">
                <div class="exchange-container" id="welcome-exchange">
                    <div class="exchange-header">
                        <span class="exchange-summary">üí¨ Welcome Message</span>
                        <span class="exchange-toggle">‚ñº</span>
                    </div>
                    <div class="exchange-content">
                        <div class="message assistant">
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-content">
                                <p>Hello! I'm MRA v3, your research assistant. I can help you:</p>
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    <li>Search across your reference papers and authored papers</li>
                                    <li>Perform web searches with BRAVE API</li>
                                    <li>Answer questions using Ollama LLMs</li>
                                    <li>Apply rhetorical distortion via TwistedPair</li>
                                </ul>
                                <p style="margin-top: 0.75rem;">What would you like to explore?</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="input-wrapper">
                    <textarea 
                        id="user-input" 
                        placeholder="Ask a question or search your documents..."
                        rows="2"
                    ></textarea>
                    <button class="send-btn" id="send-btn">Send</button>
                </div>
            </div>
        </main>

        <!-- Right Panel: Sessions -->
        <aside class="right-panel">
            <div class="panel-tabs">
                <div class="panel-tab active" data-tab="sessions">
                    <span>üìã Sessions</span>
                    <span class="panel-toggle" id="sessions-toggle">‚ñº</span>
                </div>
            </div>

            <!-- Sessions Panel -->
            <div class="panel-content active" id="sessions-panel">
                <button class="send-btn" style="width: 100%; margin-bottom: 1rem;" id="new-session-btn">
                    + New Session
                </button>
                <div id="session-list">
                    <div class="session-item active">
                        <h4>Current Session</h4>
                        <div class="meta">Just now ‚Ä¢ 1 message</div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script src="app.js"></script>
</body>
</html>
